# 第11章 索引和散列
## 11.1 基本概念
* 两种基本类型的索引
  * 顺序索引：基于值的顺序排序
  * 散列索引：使用散列函数计算出值，平均分布到若干散列桶中
* 使用索引技术的考量因素
  * 访问类型(access type): 找到具有特定属性的记录(hash)，或者找到特定范围的记录(tree)
  * 访问时间(access time): 
  * 插入时间(insertion time):
  * 删除时间(deletion time):
  * 空间开销(space overhead):
* 通常需要在一个文件上建立多个索引(多个列分别建立索引)
* 搜索码(search key): 如果一个文件有多个索引，它就有多个搜索码

## 11.2 顺序索引
* 聚集索引/主索引(clustering index/primary index): 包含记录的文件被按照某个搜索码指定的顺序排序。
* 非聚集索引/辅助索引(nonclustering index/secondary index): 搜索码指定的顺序与文件记录的物理顺序不同。

### 11.2.1 稠密索引和稀疏索引
* 索引项(index entry)/索引记录(index record): 由一个搜索码值和具有该搜索码值的一条或多条记录的指针构成。
* 稠密索引(dense index): 每个搜索码值都有一个索引项
* 稀疏索引(sparse index): 只为搜索码的某些值建立索引项

### 11.2.2 多级索引
* 两级或以上的索引

### 11.2.3 索引的更新
* 插入
  * 稠密索引
    * 如果该搜索码不在索引中，在索引中合适位置插入具有该搜索码值的索引项
    * 否则进行以下操作
      * 如果索引项存储的是指向具有相同搜索码值的所有记录的指针，在索引项中增加一个指向新记录的指针。
      * 否则，索引项存储一个仅指向具有相同搜索码值的第一条记录的指针，系统把待插入的记录放到具有相同搜索码值的其他记录之后。
  * 稀疏索引
    * 如果创建了一个新的块，将新的块中出现的第一个搜索码的值插入到索引中。
    * 如果新插入的数据是新的块中的最小值，更新指向该块的索引项
    * 否则不做任何操作
* 删除
  * 稠密索引

### 11.2.5 多码上的索引(联合索引)
* 字典序(lexicographic order), 所以有最左匹配原则

## 11.5 多码(composite search key)访问
* 使用多个单列索引的查询策略(SELECT A, B from table where A > 1 and B > 2)
  1. 使用索引A, 然后在结果中搜索B
  2. 使用索引B, 然后再结果中搜索A
  3. 同时使用索引A和B, 然后取它们的交集
  * 只有第三种方法实际利用到了多个索引，但是这也是有缺陷的，如果其中一个结果数量很多或很少，效率不如直接只使用一个索引
